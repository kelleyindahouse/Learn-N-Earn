<!DOCTYPE html>
<html>

<head>
  <title>Job Posts</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/uikit.min.css">
  <script src="js/uikit.min.js"></script>
  <script src="js/uikit-icons.js"></script>
</head>

<body>

  <!-- navbar -->

  <nav class="uk-navbar-container" uk-navbar>
    <div class="uk-navbar-left">
      <ul class="uk-navbar-nav">
        <li class="uk-active"><a href="index.html">Learn-n-Earn</a></li>
        <li>
          <a href="#">Campuses</a>
          <div class="uk-navbar-dropdown">
            <ul class="uk-nav uk-navbar-dropdown-nav">
              <li class="uk-active"><a href="UCLA.html">UCLA</a></li>
              <li class="uk-nav-divider"></li>
              <li><a href="UCSB.html">UCSB</a></li>
              <li class="uk-nav-divider"></li>
              <li><a href="UCSD.html">UCSD</a></li>
              <li class="uk-nav-divider"></li>
              <li><a href="UCI.html">UCI</a></li>
              <li class="uk-nav-divider"></li>
            </ul>
          </div>
        </li>
        <li><a href="login.html">Login</a></li>
      </ul>
    </div>
    <div class="uk-navbar-right">
      <ul class="uk-navbar-nav">
        <li>
          <a class="uk-margin-right" href="#">About</a>
          <div class="uk-navbar-dropdown">
            <ul class="uk-nav uk-navbar-dropdown-nav">
              <li class="uk-active"><a href="about.html">About Us</a></li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
  </nav>
  <br>

  <div id="posts" class="uk-grid-match uk-grid-small" uk-grid>
    
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  
  <script>
    //function to retrieve posts from database
    async function getPosts() {
      try {
        const { data: posts } = await axios.get('/api/posts', {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          }
        })
        return posts

      } catch (err) {
        location = '/login.html'
      }
    }

    //function to render posts onto page
    async function renderPosts() {
      const posts = await getPosts()

      console.log(posts)

      posts.forEach(({ title, body, createdAt, User: { username } }) => {
        const postElem = document.createElement('div')
        postElem.classList.add("uk-width-1-2@m", "uk-width-1-1@s")
        postElem.innerHTML = `
        <div class="uk-card uk-card-hover uk-card-default ">
          <div class="uk-card-header">
            <div class="uk-grid-small uk-flex-middle" uk-grid>
              <div class="uk-width-auto">
                <img class="uk-border-circle" width="50" height="50" src="/images/wallet.jpg">
              </div>
              <div class="uk-width-expand">
                <h3 class="uk-card-title uk-margin-remove-bottom">${title}</h3>
                <p class="uk-text-meta uk-margin-remove-top">Posted by: ${username}</p>
                <p class="uk-text-meta uk-margin-remove-top">${createdAt}</p>
              </div>
            </div>
          </div>
          <div class="uk-card-body">
            <p>${body}</p>
          </div>
          <div class="uk-card-footer">
            <a href="#" class="uk-button uk-button-text">Read more</a>
          </div>
        </div>
        `
        document.getElementById('posts').append(postElem)
      })
    }

    renderPosts()

  </script>

</body>

</html>